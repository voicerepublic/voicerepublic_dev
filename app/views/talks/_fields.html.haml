- content_for :javascript do
  = render partial: 'config'

= f.input :dryrun, as: :hidden

.form-top-box.row
  .medium-12.columns
    .title-box
      %h2.form-title= form_title

    -#= f.error_messages

    - opts = {}
    -# TODO some fields are protected after state prelive, add this to cancan
    -#- opts[:disabled] = true unless f.object.created?

    .row.title-teaser-box
      .medium-7.columns
        = f.input :title, placeholder: t('.title')
        = f.input :teaser, placeholder: t('.teaser'), as: "text", input_html: {maxlength: 140}
      .medium-5.columns
        = f.input :language, as: :grouped_select, collection: Talk::LANGUAGES,
          input_html: { class: 'languageSelect' },
          group_method: :last, label_method: :last, value_method: :first
        = f.input :tag_list, input_html: { class: 'tagList', 'data-pre' => @talk.tag_list.join(',') }

    .row
      .medium-12.columns
        = f.input :speakers, placeholder: t('.speakers')

    .title-box.clearfix
      %h2.form-title= t('.choose_date_and_time')
    .date-time-picker-row.row
      .medium-4.columns
        - disable = [:live].include?(@talk.state.to_sym)
        = f.input :starts_at_date, opts.merge(input_html: {'data-picker' => 'date'}, disabled: disable)
      .medium-4.columns
        = f.input :starts_at_time, opts.merge(input_html: {'data-picker' => 'time'}, disabled: disable)
      .medium-4.columns
        = f.input :duration, opts.merge(collection: Settings.durations, disabled: disable)

    .title-box.clearfix
      %h2.form-title.left= t('.add_to_series')
      .help-text.left= t('.series_help_text')
    .row
      .medium-6.columns
        = f.association :series, collection: current_user.series,
          include_blank: t('.create_new_series'),
          input_html: { 'data-on-blank-show' => '#wrapper_new_series_title' }
      .medium-6.columns
        = f.input :new_series_title, wrapper_html: { id: 'wrapper_new_series_title' }

    .title-box.clearfix
      %h2.form-title.left= t('.illustrate_and_describe')
      .help-text.left= t('.ill_and_desc_text')
    .row
      .medium-3.columns
        .image-box(style="background-image: url(#{f.object.image.url})" data-show-upload="#talk_image,#series_talks_attributes_0_image")
      .medium-9.columns
        %button.button-standard(type="button" data-trigger-file-input="#talk_image")
          = t('.select_image')
        = f.file_field :image, as: :file, class: 'soft-hide'

    .row
      .medium-12.columns
        = f.input :description, input_html: { rows: 10 }

    .title-box.clearfix
      %h2.form-title.left= t('.invite_guests')
      .help-text.left= t('.invite_guests_text')
    .row
      .medium-12.columns
        = f.input :guest_list, opts.merge(input_html: { class: 'guestList' })

    .title-box.clearfix
      %h2.form-title.left= t('.upload_slides')
      = f.input :slides_uuid, as: :hidden
      - if f.object.new_record? and f.object.slides_uuid?
        .help-text.left= t('.upload_done')
      - else
        = render partial: 'shared/upload',
                 locals: { f: f, ns: 'slides', init: init_slides_uploader }
