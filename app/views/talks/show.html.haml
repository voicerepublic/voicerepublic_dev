.layout-talk(ng-controller='Livepage')
  .talk-upper-block{ :style => "background-image: url(http://lorempixel.com/1200/600/people/1)"}
    %section.talk-title-box.row.text-center
      .large-12.columns
        .talk-venue-title
          = link_to @talk.venue.title, @talk.venue
        .talk-host-name
          = @talk.user.name
        %h2.talk-title
          = @talk.title
        %h3.talk-teaser
          = @talk.teaser
        %h3.talk-tags
          = @talk.tag_list
        .talk-date-time MAY 6, 2014 | 17:00 -17.30
        .talk-date-time
          {{ countdown }}
        #flashContent
        %h3(ng-show='talkIsPrelive()') talk is prelive
        %h3(ng-show='talkIsLive()') talk is live
        %h3(ng-show='talkIsPostlive()') talk is postlive

  .talk-live-row
    .row
      .talk-talkers-box.large-10.large-offset-1.columns
        .debug
          %ul
            -# %li config: {{ config }}
            -# %li session: {{ session }}
            -# %li session.config: {{ session.config }}
            -# %li session.config.host: {{ session.config.host }}
            -# %li config.host: {{ config.host }}
            -# %li config.title: {{ config.title }}
            -# %li config.teaser: {{ config.teaser }}
            -# %li session.fsm.current: {{ session.fsm.current }}
            -# %li session.users: {{ session.users }}
            %li acceptOrDecline: {{ flags.acceptOrDecline }}
            %li onair: {{ flags.onair }}
            %li config.talk.state: {{ config.talk.state }}
        .host.avatar.avatar-host      
          %p.avatar-name.text-center
            {{ config.host }}
          %img.avatar-img(src="http://lorempixel.com/80/80/people/1/")
          
        .guest.avatar(ng-repeat="guest in session.guests()")
          %span(ng-click="session.demote(guest.id)")
            %p.avatar-name.text-center
              {{ guest.name }}
            %img.avatar-img(ng-src="{{guest.image}}")
    
    .talk-live-mic-states-row.row
      .large-12.columns.text-center
        #onair(ng-show='flags.onair') On Air
        %button.button(ng-show='showStartTalk()'
          ng-click='session.startTalk()')= t('.start_talk')
        %button.button(ng-show='showEndTalk()'
          ng-click='session.endTalk()')= t('.end_talk')
        %button.button(ng-show='flags.reqmic'
          ng-click='requestMic()') Request Mic
        %button.button(ng-show='flags.onair'
          ng-click='blackbox.mute()') Mute
        %button.button(ng-show='flags.onair'
          ng-click='blackbox.unmute()') Unmute 
        %button.button(ng-show='flags.acceptOrDecline'
          ng-click='acceptPromotion()') Accept
        %button.button(ng-show='flags.acceptOrDecline'
          ng-click='declinePromotion()') Decline
        %button.button(ng-click='blackbox.setVolume(0)') Mute Streams
        %button.button(ng-click='blackbox.setVolume(1)') Unmute Streams
    
    .talk-tabs-box.row
      .large-12.columns
        %dl.tabs.talk-tabs(data-tab="true")
          %dd.text-center
            %a(href="#talk-tab-description")
              =t('.description')
          %dd.text-center
            %a(href="#talk-tab-discussion")
              =t('.discussion')
          %dd.active.text-center
            %a(href="#talk-tab-participants")
              Participants
              %span(ng-show='session.expectingPromotion().length')
                ({{ session.expectingPromotion().length }} MicReq.)
              %span(ng-show='session.acceptingPromotion().length')
                ({{ session.acceptingPromotion().length }} Await.)

  .talk-tabs-content-block
    .row
      .tabs-content.large-12.columns     
        #talk-tab-description.content
          = @talk.description.html_safe
        #talk-tab-discussion.content
          %p Some discussion here
        #talk-tab-participants.content.active
          .expecting_promotion(ng-show='session.expectingPromotion().length')
            %h3= t('.microphone_requests')
            .participant.avatar(ng-repeat="parti in session.expectingPromotion()")
              %span(ng-click="session.promote(parti.id)")
                %p.avatar-name.text-center {{ parti.name }}
                %img.avatar-img(ng-src="{{parti.image}}")
          .accepting_promotion(ng-show='session.acceptingPromotion().length')
            %h3= t('.awaiting_to_speak')
            .participant.avatar(ng-repeat="parti in session.acceptingPromotion()")
              %p.avatar-name.text-center {{ parti.name }}
              %img.avatar-img(ng-src="{{parti.image}}")
          .participating(ng-show='session.participants().length')
            %h3= t('.participating')
            .participant.avatar(ng-repeat="parti in session.participants()")
              %span(ng-click="session.promote(parti.id)")
                %p.avatar-name.text-center {{ parti.name }}
                %img.avatar-img(ng-src="{{parti.image}}")
          .listening
            %h3
              {{ session.listeners().length }}
              = t('.just_listening_in')
  
.chat

.log

.scripts
  %script(src='/assets/livepage.js')
  = render 'config'
        

%p#notice= notice

.draft
  = image_tag @talk.image.thumb('400x200#').url if @talk.image_stored?
  %h2 This is the common part.
  %p= @talk.user.name  
  %p= @talk.title
  %p= @talk.teaser

.draft
  %h2 This will be the new talk page (prelive).
  %p
    = l(@talk.starts_at, format: :designed)
    â€”
    = distance_of_time_in_words(@talk.starts_at, @talk.ends_at)
    (#{@talk.duration} minutes)
  %p
    starts in
    = distance_of_time_in_words_to_now(@talk.starts_at)
    (#{@talk.starts_in} seconds)

.draft
  %h2 This will be the new talk page (live).

  %p
    ends in
    = distance_of_time_in_words_to_now(@talk.ends_at)
    (#{@talk.ends_in} seconds)
  %p= link_to t('.edit'), [:edit, @venue, @talk]
  %p= link_to t('.delete'), [@venue, @talk], method: :delete, data: { confirm: t('.confirm_delete', default: 'Are you sure?' ) }
  %p TODO progressbar
  %p TODO host and quests

